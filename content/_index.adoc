---
title: Эргономичный подход
description: Способ быстро создавать эргономичные кодовые базы - кодовые базы, которые легко менять для поддержки новых требований
type: docs
---

:source-highlighter: rouge
:icons: font
:sectanchors:
:toc:
:imagesdir: /ergo-wiki/docs/images

== Об Эргономичном подходе

_Эргономичный подход - способ быстро создавать эргономичные кодовые базы - кодовые базы, которые легко менять для поддержки новых требований._

Критерии, которым должна соответствовать хорошая кодовая база давно известны: её поведение должно быть полностью покрыто быстрыми автоматическими тестами, а реализация должна обладать высокой функциональной связанностью (cohesion) и низкой сцепленностью (coupling).

Однако, множество кодовых баз всё ещё не соответствуют этим критериям.
Как следствие, критические ошибки и горящие сроки являются "естественным" состоянием дел для многих команд.

Мне такое состояние дел не подходит, и для того, чтобы вместе со своими командами систематически и быстро создавать хорошие кодовые базы я разработал Эргономичный подход.

Эргономичный подход - это набор принципов, моделей, методик и шаблонов, которые помогают быстро проектировать и разрабатывать кодовые базы, полностью покрытые автоматическими тестами и с реализацией обладающей высокой функциональной связанностью (cohesion) и низкой сцепленностью (coupling).

== Суть Эргономичного подхода

По большому счёту Эргономичный подход можно свести к нескольким правилам в трёх областях:

. Тестирование:
.. тесты должны работать преимущественно через публичное АПИ;
.. 100% поведения системы должно быть покрыто тестами;
.. моки должны использоваться только для верификации взаимодействия с неуправляемыми зависимостями либо для симуляции сложновоспроизводимого поведения (в первую очередь системные ошибки) управляемых зависимостей;
.. тесты должны быть быстрыми - < 10 секунд на полный цикл запуска одного теста, <60 секунд на запуск всех тестов сервиса;

. Проектирование поведения:
.. Бизнес-логика и ввод-вывод должны быть разделены;
.. Бизнес-логика должна быть написана в виде чистых функций без побочных эффектов;

. Моделирование предметной области:
.. Предметная область должна быть разбита на небольшие слабосвязанные агрегаты;
.. Агрегаты и связи между ними должны образовывать направленный ацикличный граф;
.. Агрегаты должны быть представлены в коде неизменяемыми объектами, хранящиеся в изменяемых репозиториях.

На практике соблюдать эти правила не так просто, как может показаться на первый взгляд.

Прямолинейных подход к написанию тестов на поведение может привести к их очень медленной работе и кровавому месиву в коде сетапа фикстуры.

А разделение бизнес-логики и ввода-вывода в сложной операции системы или декомпозиция нетривальной модели на агрегаты может оказаться сложной задачей даже для опытного разработчика.

Поэтому весь свой опыт разработки в соответствии с этими правилами я свожу в модели, методики и шаблоны, которые позволяют всей команде не наступать на одни и те же грабли и не изобретать одни и те же велосипеды по нескольку раз.

== Промышленное применение Эргономичного подхода

С 2020 года я вместе с несколькими командами сделал в соответствии с Эргономичным подходом девять коммерческих проектов - от реинжинирнга ключевых подсистем и разработки небольших сервисов до реинжиниринга и дальнейшей разработки системы размером в два человеко-года.
Суммарно по Эргономичному подходу написано уже порядка ста тысяч строк коммерческого Kotlin- и Java-кода.

Все проекты были успешно переданы в промышленную эксплуатацию или заказчикам, а проекты по реинжинирингу дали объективное и существенное улучшение характеристик кодовой базы.

Про опыт и результаты применения Эргономичного проекта в некоторых из этих проектов я рассказываю в своих выступлениях и постах.

В докладе https://rutube.ru/video/90f14fa2ffd0cc99215ac123351c7488/?t=1840&r=plemwd[Структурный дизайн. Древний секрет простого и быстрого кода] на Joker '24, его https://azhidkov.pro/posts/24/11/structured-design/#_%D0%BA%D0%B5%D0%B9%D1%81_3_project_e[расшифровки], а так же серии постов (https://azhidkov.pro/posts/23/07/project-e-results/[1], https://azhidkov.pro/posts/23/09/project-e-part1/[2], https://azhidkov.pro/posts/23/10/project-e-part2/[3]) я рассказываю о том, как выполнив реинжинирнг проекта силами юниоров, я повысил скорость и качество работы команды в три раза.

В том же https://rutube.ru/video/90f14fa2ffd0cc99215ac123351c7488/?t=1333&r=plemwd[докладе] и его https://azhidkov.pro/posts/24/11/structured-design/#_%D0%BA%D0%B5%D0%B9%D1%81_2_project_daniel[расшифровке] я так же рассказываю о реинжиниринге модуля маршрутизации чат-центра Threads (сейчас - edna.chatcenter).
В результате реинжинирнга производительность модуля выросла в 300 раз, а код реализации превратился из спагетти-кода в аккуратное дерево:

image::threads-reengineering.png[link={imagesdir}/threads-reengineering.png]

В докладе https://youtu.be/7u7LGhXlpcE?t=1352[Рациональный подход к декомпозиции систем на модули или микросервисы] на JPoint '23 и link:https://azhidkov.pro/posts/23/04/ergonomic-decomposition/#\_%D0%BA%D0%B5%D0%B9%D1%81_%D0%BA%D1%8D%D0%BC%D0%BF[посте] с его расшифровкой я рассказываю о проекте Кэмп.
Проекте, сделанным в срок двумя юниорами и с отзывом руководителя проекта на их работу: "К бэку у меня вообще претензий нет. Он просто работает".

В посте https://azhidkov.pro/posts/22/06/220611-true-story-project/[Диаграмма эффектов: пример построения] с демонстрацией процесса проектирования с помощью диаграммы эффектов я в качестве примера использую небольшой сервис, разработанный для X5 Group и обеспечивающий актуализацию информации о порядка десяти тысяч магазинов сети "Пятёрочка" по всей стране в Яндекс.Картах и 2Гис.

Наконец, в посте https://azhidkov.pro/posts/21/03/210321-project-l-testing/[Тесты, которым можно доверять], я рассказываю об устройстве тестирования проекта по проверке бизнес-гипотезы.
Этот проект позволил заказчику быстро и за фиксированную стоимость инвалидировать неудачную бизнес-идею и минимизировать потери.

Так же у меня есть два проекта с открытыми исходным кодом, сделанных по Эргономичному подходу:

* https://github.com/ergonomic-code/Trainer-Advisor[Trainer Adviser] - некоммерческий, но настоящий и относительно большой (4К строк кода, 15 таблиц) с одним реальным пользователем;
* https://github.com/ergonomic-code/Project-Mariotte[Project Mariotte] - минимальный демонстрационный проект.

== Схема версионирования статей

Все статьи на этом сайте имеют трёхзначную версию в формате x.y.z.
Смысл частей версии следующий:

. версия модели, методики или шаблона.
  Нечётные версии являются стабильными - проверенные как минимум в течении шести месяцев в коммерческом проекте.
  Чётные версии являются гипотезами - соответствующую идею я либо проверяю в текущем коммерческом проекте, либо планирую проверить в следующем;
. версия статьи.
  Особый смысл имеет только версия 0 - в этой версии статья является заглушкой, содержащей либо ссылки на посты и выступления, либо несколько предложений с основными тезисами, описывающими идею;
. минорная версия статьи.